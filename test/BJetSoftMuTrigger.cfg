#! /bin/env cmsRun

process testHLTSoftM = {
 
    # input file
    source = PoolSource {
       # b-bbar jets
       untracked vstring fileNames = { '/store/RelVal/2006/12/16/RelVal120BJets50-120/0000/00D1599A-578D-DB11-8741-001731AF68C7.root' }
       untracked int32   maxEvents = 10
    }

    # Enable debug printout from HLT modules.
    service = MessageLogger {
       untracked vstring destinations = { "cout", "log" }
       untracked PSet cout = { untracked string threshold = "INFO" }
       untracked PSet log = { untracked string threshold = "DEBUG" }
       untracked vstring debugModules = { "highestEtJets", "etCutJets", "regionalCtfWithMaterialTracks", "hltL25bmu", "hltL3bmu" }
    }

    # reconstruct jets
    include "HLTrigger/btau/data/jetTag/bHLTjets.cff"
    # setup pixel vertex and tracks
    include "HLTrigger/btau/data/jetTag/bHLTpixel.cff"
    # setup trcak and jet associators
    include "HLTrigger/btau/data/jetTag/bHLTjetrk.cff"
    # setup softmu-jet-track
    include "HLTrigger/btau/data/jetTag/bHLTjetmu.cff"

    #
    # Trigger modules for Level 2.5 and 3.
    #

    module hltL25bmu = hltSoftMuJetTag from "HLTrigger/btau/data/jetTag/hltSoftMuJetTag.cfi"
    replace hltL25bmu.JetTag = softMuJetTagsL25
    replace hltL25bmu.MinTag = 0.5  # 1 if a lepton is found in the jet, 0 otherwise

    module hltL3bmu = hltSoftMuJetTag from "HLTrigger/btau/data/jetTag/hltSoftMuJetTag.cfi"
    replace hltL3bmu.JetTag = softMuJetTagsL3
    replace hltL3bmu.MinTag = 0.1

    #
    # Event reconstruction needed for trigger.
    #

    sequence preL25bReco  = {bCalJetsReco,
                             pixelTracks, pixelVertices,
                             associatorL25, softMuJetTagsL25}

    sequence preL3bReco   = {regionalCkfTracks, 
                             associatorL3, softMuJetTagsL3}

    # Trigger path

    path p1 = {preL25bReco, hltL25bmu, 
               preL3bReco, hltL3bmu}

    # Write events passing trigger

    module out = PoolOutputModule {
      untracked string fileName = 'file:HLTSoftMuOutput.root'
      untracked PSet SelectEvents = {
        vstring SelectEvents = { "p1" }
      }
    }

    endpath outpath = { out }
}
