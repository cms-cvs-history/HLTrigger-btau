#! /bin/env cmsRun

process HLT = {
    
    # initialize MessageLogger
    include "Configuration/StandardSequences/data/FakeConditions.cff"
    untracked PSet options = {
        include "FWCore/Framework/test/cmsExceptionsFatalOption.cff"
        untracked bool wantSummary = true
        untracked bool makeTriggerResults = true 
    }
    
    # include services
    include "Configuration/ReleaseValidation/data/Services.cfi"
    include "FWCore/MessageService/data/MessageLogger.cfi"
    replace MessageLogger.cout.threshold = "ERROR"
    replace MessageLogger.cerr.default.limit = 2
    
    # initialize random number seeds
    service = RandomNumberGeneratorService {
        untracked uint32 sourceSeed = 123456789
        PSet moduleSeeds = {
            untracked uint32 VtxSmeared = 98765432
            untracked uint32 g4SimHits  = 11
        }
    }
    
    # generation parameters
    source = PythiaSource 
    { 
        untracked int32 maxEvents = 10
        untracked int32 pythiaPylistVerbosity = 0
        untracked bool  pythiaHepMCVerbosity = false
        untracked int32 maxEventsToPrint = 0
        
        PSet PythiaParameters = {
            
            # This is a vector of ParameterSet names to be read, in this order
            vstring parameterSets = {
                "pythiaUESettings", 
                "processParameters"
            }
            
            include "Configuration/Generator/data/PythiaUESettings.cfi"
            
            vstring processParameters = {
                'MSEL      = 0           ! User defined processes',
                'MSUB(81)  = 1           ! qqbar to QQbar',
                'MSUB(82)  = 1           ! gg to QQbar',
                'MSTP(7)   = 6           ! flavour = top',
                'PMAS(6,1) = 175.        ! top quark mass'
            }
        }
    }
    
    # simulation parameters
    include "Configuration/StandardSequences/data/Simulation.cff"
    include "Configuration/StandardSequences/data/VtxSmearedGauss.cff"
    include "Configuration/StandardSequences/data/MixingNoPileUp.cff" 
    
    # relaxed L1 Trigger
    include "L1Trigger/L1ExtraFromDigis/data/l1extra.cff"
    replace l1extraParticleMap.singleMuonMinEt =  5.0
    replace l1extraParticleMap.singleJetMinEt  = 10.0
    
    # event reconstruction for HLT
    include "Configuration/StandardSequences/data/FakeConditions.cff"
    path p1 = { psim, pdigi }  # simulation

    include "HLTrigger/btau/data/jetTag/bHLT_LifetimeTrigger.cff"
    include "HLTrigger/btau/data/jetTag/bHLT_bSoftmuTrigger.cff"
    #replace hltL2b1jet.MinPt = 10.0
    #replace hltL2b2jet.MinPt = 10.0
    #replace hltL2b3jet.MinPt = 10.0
    #replace hltL2b4jet.MinPt = 10.0
    #replace hltL25b.MinTag   = 0
    #replace hltL3b.MinTag    = 0
    #replace hltL25bmu.MinTag = 0
    #replace hltL3bmu.MinTag  = 0

    # event output
    include "Configuration/EventContent/data/EventContent.cff"
    module GEN-SIM-DIGI-HLT = PoolOutputModule 
    { 
        using FEVTSIMEventContent
                            
        untracked string fileName = "file:test.root"
        untracked PSet datasets = {
            untracked PSet dataset1 = {
                untracked string dataTier = "GEN"
            }
            untracked PSet dataset2 = {
                untracked string dataTier = "SIM"
            }
            untracked PSet dataset3 = {
                untracked string dataTier = "DIGI"
            }
        }
    }
    include "HLTrigger/btau/data/jetTag/eventContent_Lifetime.cff"
    include "HLTrigger/btau/data/jetTag/eventContent_SoftMu.cff"
    replace GEN-SIM-DIGI-HLT.outputCommands += JetTagLifetimeHLT.outputCommands
    replace GEN-SIM-DIGI-HLT.outputCommands += JetTagSoftMuHLT.outputCommands
    
    endpath outpath = { GEN-SIM-DIGI-HLT }
    
    schedule = { 
      p1,
      bHLTpath1, bHLTpath2, bHLTpath3, bHLTpath4,
      bmuHLTpath1, bmuHLTpath2, bmuHLTpath3, bmuHLTpath4
    }

}
